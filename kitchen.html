<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>料理廚房</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { 
            background-color: #d35400; color: #fff; /* 橘色系背景代表廚房 */
            font-family: 'Press Start 2P', monospace; 
            text-align: center; padding: 10px; margin: 0;
            display: flex; flex-direction: column; height: 100dvh; box-sizing:border-box;
        }
        .header { padding: 10px; border-bottom: 2px solid #fff; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .back-btn { background: #34495e; border: 2px solid #fff; color: white; padding: 8px; cursor: pointer; font-family: inherit; font-size: 10px; text-decoration: none;}
        
        .gold-display { font-size: 12px; color: #f1c40f; margin-bottom: 15px; }

        .recipe-container { display: grid; grid-template-columns: 1fr; gap: 10px; padding: 5px; overflow-y: auto; flex: 1; }
        
        .recipe-card { 
            background: #e67e22; border: 4px solid #a04000; 
            padding: 15px; border-radius: 8px; text-align: left;
            position: relative;
        }
        .recipe-name { color: #fff; font-size: 14px; margin-bottom: 5px; font-weight: bold; }
        .recipe-desc { font-size: 10px; color: #fce4ec; margin-bottom: 10px; }
        
        /* ߟ⠦퐦晥藨ᨦ裥쏠*/
        .mat-list { 
            font-size: 10px; color: #fff; margin-bottom: 10px; 
            background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; 
        }
        .mat-item { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .mat-ok { color: #2ecc71; } /* 足夠顯示綠色 */
        .mat-no { color: #e74c3c; } /* 不足顯示紅色 */
        
        /* ߟ⠦쉩蕦裥쏠*/
        .btn-cook { 
            width: 100%; padding: 12px; 
            font-family: inherit; font-size: 12px; font-weight: bold; border-radius: 6px;
            cursor: pointer; border: 2px solid transparent;
            transition: all 0.2s;
        }
        .btn-ready { 
            background: #2ecc71; color: white; border-color: #27ae60; 
            box-shadow: 0 4px 0 #27ae60;
        }
        .btn-ready:active { transform: translateY(2px); box-shadow: 0 2px 0 #27ae60; }
        
        .btn-disabled { 
            background: #7f8c8d; color: #bdc3c7; border-color: #95a5a6; 
            cursor: not-allowed; opacity: 0.8;
        }

        #game-toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); border: 2px solid #f1c40f; padding: 10px 20px; border-radius: 20px; z-index: 999; transition: top 0.5s; font-size: 12px; white-space: nowrap; }
    </style>
</head>
<body>
    <div id="game-toast"></div>
    
    <div class="header">
        <span style="font-size:12px;">ߍ㠦晧ƥ뚦迼/span>
        <a href="hub.html" class="back-btn">回大廳</a>
    </div>
    
    <div class="gold-display">ߒࠦ쁦쉩瑥飺 <span id="my-gold">0</span> G</div>

    <div id="recipe-list" class="recipe-container">
        <div style="font-size:12px; color:#ddd; margin-top:20px;">載入食譜中...</div>
    </div>

    <script src="socket.io.js"></script>
    <script>
const socket = io('https://mmo.ttctv-105.cc', { 
    transports: ['websocket', 'polling'],
    secure: true // 因為你用 https，建議加呢個
});
        
        let myToken = localStorage.getItem('rpg_token');
        if (!myToken) window.location.href = 'index.html';

        let myInventory = {};
        let myGold = 0;
        let allRecipes = [];
        
        // 只顯示料理類的配方 ID
        const FOOD_IDs = ['grilled_carp', 'salmon_sushi', 'tuna_steak', 'eel_rice', 'void_soup', 'sushi_plate'];

        socket.on('connect', () => {
            socket.emit('joinGame', myToken);
            socket.emit('getRecipes'); // 請求配方資料
        });

        // ߟ⠱. 接收玩家背包資料
        socket.on('playerStatsUpdate', (p) => { 
            myInventory = p.inventory; 
            myGold = p.gold;
            document.getElementById('my-gold').innerText = myGold;
            renderRecipes(); // 資料更新時重繪介面
        });

        // ߟ⠲. 接收配方資料
        socket.on('recipeList', (recipes) => {
            allRecipes = recipes;
            renderRecipes();
        });

        socket.on('craftResult', (res) => {
            showToast(res.success ? "✅ " + res.msg : "❌ " + res.msg);
        });

        function renderRecipes() {
            if (allRecipes.length === 0) return;

            const container = document.getElementById('recipe-list');
            container.innerHTML = '';

            allRecipes.forEach(r => {
                // 篩選：只顯示食物
                if (!FOOD_IDs.includes(r.itemId)) return;

                const div = document.createElement('div');
                div.className = 'recipe-card';
                
                let canCook = true;
                let matsHtml = '';

                // ߟ⠦ꢦ復퐦晦该ন泥䠊                r.materials.forEach(m => {
                    const have = myInventory[m.id] || 0;
                    const need = m.count;
                    const isEnough = have >= need;
                    
                    if (!isEnough) canCook = false;

                    const colorClass = isEnough ? 'mat-ok' : 'mat-no';
                    matsHtml += `
                        <div class="mat-item">
                            <span>${m.name}</span>
                            <span class="${colorClass}">${have}/${need}</span>
                        </div>
                    `;
                });

                // 檢查金錢
                if (myGold < r.goldCost) canCook = false;
                const goldClass = (myGold >= r.goldCost) ? 'mat-ok' : 'mat-no';

                // ߟ⠨譥쉩蕧뀦勊                let btnHtml = '';
                if (canCook) {
                    btnHtml = `<button class="btn-cook btn-ready" onclick="cook('${r.itemId}')">ߍ㠥ﯤ륧㹩㪼/button>`;
                } else {
                    btnHtml = `<button class="btn-cook btn-disabled" disabled>❌ 材料/金錢不足</button>`;
                }

                div.innerHTML = `
                    <div class="recipe-name">ߍᠤ{r.itemName}</div>
                    <div class="recipe-desc">${r.itemDesc}</div>
                    <div class="mat-list">
                        ${matsHtml}
                        <div class="mat-item" style="border-top:1px dashed #fff; margin-top:4px; padding-top:4px;">
                            <span>製作費用</span>
                            <span class="${goldClass}">${r.goldCost} G</span>
                        </div>
                    </div>
                    ${btnHtml}
                `;
                container.appendChild(div);
            });
        }

        function cook(id) {
            socket.emit('craftItem', id);
        }

        function showToast(msg) {
            const t = document.getElementById('game-toast');
            t.innerText = msg;
            t.style.top = "30px";
            setTimeout(() => { t.style.top = "-100px"; }, 2000);
        }
    </script>
</body>
</html>
