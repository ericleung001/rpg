<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‹‡è€…ç‰©èª - ç™»å…¥v3</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body { 
            background-color: #2c3e50; color: #fff; 
            font-family: 'Press Start 2P', monospace; 
            text-align: center; 
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            height: 100dvh; margin: 0; 
            overscroll-behavior: none;
        }

        .login-card {
            background: #34495e; border: 4px solid #fff; 
            padding: 30px 20px; width: 90%; max-width: 400px; 
            border-radius: 12px; box-sizing: border-box;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        h1 { 
            font-size: 24px; margin-bottom: 30px; 
            color: #f1c40f; text-shadow: 2px 2px #000; 
            line-height: 1.5;
        }

        .input-group { margin-bottom: 20px; text-align: left; }
        
        label { 
            display: block; margin-bottom: 8px; 
            font-size: 12px; color: #bdc3c7; 
        }

        input { 
            width: 100%; padding: 15px; 
            font-family: inherit; font-size: 16px; 
            background: #2c3e50; border: 2px solid #95a5a6; 
            color: #fff; box-sizing: border-box; 
            outline: none; border-radius: 6px;
        }
        input:focus { border-color: #3498db; }

        .btn-group { 
            display: flex; flex-direction: column; gap: 15px; margin-top: 30px; 
        }

        .btn { 
            padding: 18px; font-family: inherit; font-size: 16px; 
            cursor: pointer; color: white; border: none; 
            border-radius: 8px; font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }

        .btn-login { background: #27ae60; border: 2px solid #2ecc71; }
        .btn-register { background: #2980b9; border: 2px solid #3498db; }

        #msg { 
            margin-top: 20px; min-height: 20px; 
            font-size: 12px; color: #e74c3c; 
        }
    </style>
</head>
<body>

    <div class="login-card">
        <h1>âš”ï¸ å‹‡è€…ç‰©èª ï¸<br><span style="font-size:12px; color:#fff;">ONLINE</span></h1>
        
        <div class="input-group">
            <label>å¸³è™Ÿ / Username (æœ€å°‘5ä½)</label>
            <input type="text" id="username" placeholder="è¼¸å…¥å¸³è™Ÿ..." maxlength="12">
        </div>
        
        <div class="input-group">
            <label>å¯†ç¢¼ / Password (æœ€å°‘5ä½)</label>
            <input type="password" id="password" placeholder="è¼¸å…¥å¯†ç¢¼..." maxlength="20">
        </div>

        <div id="msg"></div>

        <div class="btn-group">
            <button class="btn btn-login" onclick="doLogin()">ç™»å…¥ (Login)</button>
            <button class="btn btn-register" onclick="doRegister()">è¨»å†Š (Register)</button>
        </div>
    </div>

    <script src="socket.io.js"></script>
    <script>
        //  æ›¿æ›æˆä½ çœŸæ­£çš„å¾Œç«¯ç¶²å€ (è¨˜å¾—è¦ç”¨ https / wss)
		// é€™æ˜¯åŠ å¯†å¾Œçš„ç¶²å€ (ä¸€èˆ¬äººçœ‹ä¸æ‡‚é€™æ˜¯ä»€éº¼)
		const _0x5a1b = "aHR0cHM6Ly9ycGdnYW1lc2VyLmNj"; 
		const BACKEND_URL = atob(_0x5a1b);
		
		const socket = io(BACKEND_URL, {
		    transports: ['websocket', 'polling'],
		    secure: true // ğŸ”’ å¼·åˆ¶ä½¿ç”¨åŠ å¯†é€£ç·š (HTTPS/WSS)
		});

        if(localStorage.getItem('rpg_token')) {
            window.location.href = 'hub.html';
        }

        socket.on('authResult', (res) => {
            if (res.success) {
                if (res.token) {
                    localStorage.setItem('rpg_token', res.token);
                    document.getElementById('msg').style.color = '#2ecc71';
                    document.getElementById('msg').innerText = "ç™»å…¥æˆåŠŸï¼è½‰è·³ä¸­...";
                    setTimeout(() => window.location.href = 'hub.html', 500);
                } else {
                    document.getElementById('msg').style.color = '#2ecc71';
                    document.getElementById('msg').innerText = "è¨»å†ŠæˆåŠŸï¼è«‹é»æ“Šç™»å…¥ã€‚";
                }
            } else {
                document.getElementById('msg').style.color = '#e74c3c';
                document.getElementById('msg').innerText = res.msg;
                // éœ‡å‹•ç‰¹æ•ˆ
                document.querySelector('.login-card').animate([
                    { transform: 'translateX(0)' }, { transform: 'translateX(-10px)' }, 
                    { transform: 'translateX(10px)' }, { transform: 'translateX(0)' }
                ], { duration: 300 });
            }
        });

        function doLogin() {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();
            
            if(!u || !p) { showMsg("è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼"); return; }
            if(u.length < 5) { showMsg("å¸³è™Ÿè‡³å°‘éœ€ 5 å€‹å­—å…ƒ"); return; }
            if(p.length < 5) { showMsg("å¯†ç¢¼è‡³å°‘éœ€ 5 å€‹å­—å…ƒ"); return; }

            socket.emit('login', { user: u, pass: p });
        }

        function doRegister() {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();
            
            if(!u || !p) { showMsg("è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼"); return; }
            if(u.length < 5) { showMsg("å¸³è™Ÿè‡³å°‘éœ€ 5 å€‹å­—å…ƒ"); return; }
            if(p.length < 5) { showMsg("å¯†ç¢¼è‡³å°‘éœ€ 5 å€‹å­—å…ƒ"); return; }

            socket.emit('register', { user: u, pass: p });
        }

        function showMsg(text) {
            document.getElementById('msg').innerText = text;
        }
    </script>
</body>
</html>
