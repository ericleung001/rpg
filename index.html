<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å†’éšªè€…å…¬æœƒ - ç™»å…¥</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body { 
            background-color: #2c3e50; color: #ecf0f1; 
            font-family: 'Press Start 2P', monospace; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 100dvh; margin: 0; 
            background-image: radial-gradient(#34495e 15%, transparent 16%), radial-gradient(#34495e 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        .container {
            background: #fff; color: #333; 
            padding: 30px 20px; 
            border-radius: 10px; 
            border: 4px solid #000;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.5);
            text-align: center;
            width: 90%;
            max-width: 400px;
        }

        h1 { font-size: 24px; margin-bottom: 30px; color: #e74c3c; text-shadow: 2px 2px 0 #000; }

        input {
            width: 100%; padding: 15px; margin: 10px 0; 
            font-family: inherit; font-size: 14px; 
            border: 2px solid #333; background: #eee;
            box-sizing: border-box;
            outline: none;
        }
        input:focus { background: #fff; border-color: #3498db; }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }

        button {
            flex: 1; padding: 15px; 
            font-family: inherit; font-size: 14px; font-weight: bold; 
            cursor: pointer; border: 2px solid #000; 
            transition: all 0.1s;
        }

        #btn-login { background: #2ecc71; color: white; }
        #btn-reg { background: #f1c40f; color: black; }

        button:active { transform: translateY(3px); box-shadow: none; }
        
        #msg { margin-top: 15px; font-size: 12px; min-height: 20px; color: #c0392b; }
        
        .footer { margin-top: 30px; font-size: 10px; color: #bdc3c7; }
    </style>
</head>
<body>

    <div class="container">
        <h1>âš”ï¸ å†’éšªè€…å…¬æœƒ</h1>
        
        <input type="text" id="user" placeholder="å¸³è™Ÿ (Username)" maxlength="20">
        <input type="password" id="pass" placeholder="å¯†ç¢¼ (Password)" maxlength="20">
        
        <div class="btn-group">
            <button id="btn-login" onclick="doAuth('login')">ç™»å…¥</button>
            <button id="btn-reg" onclick="doAuth('register')">è¨»å†Š</button>
        </div>

        <div id="msg"></div>
    </div>

    <div class="footer">Server Status: <span id="status" style="color:red">Connecting...</span></div>

    <script src="socket.io.js"></script>
    <script>
        // ğŸŸ¢ é€£ç·šè¨­å®š
        const _0x5a1b = "aHR0cHM6Ly9ycGdnYW1lc2VyLmNj"; 
        const BACKEND_URL = atob(_0x5a1b);
        
        const socket = io(BACKEND_URL, {
            transports: ['websocket', 'polling'],
            secure: true 
        });

        const statusSpan = document.getElementById('status');
        const msgDiv = document.getElementById('msg');

        // 1. è‡ªå‹•ç™»å…¥æª¢æŸ¥
        const savedToken = localStorage.getItem('rpg_token');
        if (savedToken) {
            msgDiv.innerText = "å˜—è©¦è‡ªå‹•ç™»å…¥ä¸­...";
            // ç¨å¾Œåœ¨ connect äº‹ä»¶ä¸­ç™¼é€ token
        }

        socket.on('connect', () => {
            statusSpan.innerText = "Online";
            statusSpan.style.color = "#2ecc71";
            
            // å¦‚æœæœ‰èˆŠ tokenï¼Œå˜—è©¦ç›´æ¥è·³è½‰
            if (savedToken) {
                 // é€™è£¡æˆ‘å€‘ä¸ç›´æ¥è·³è½‰ï¼Œè€Œæ˜¯ç­‰ä½¿ç”¨è€…æ‰‹å‹•æ“ä½œï¼Œæˆ–è€…ä½ å¯ä»¥é¸æ“‡ç›´æ¥è·³è½‰
                 // ç‚ºäº†å®‰å…¨ï¼Œæˆ‘å€‘è®“ä½¿ç”¨è€…åœç•™åœ¨ç™»å…¥é é¢ï¼Œæˆ–è€…ä½ å¯ä»¥åŠ ä¸Š socket.emit('checkToken', savedToken) çš„é‚è¼¯
                 // ç°¡å–®èµ·è¦‹ï¼Œæˆ‘å€‘ç›´æ¥è®“å·²ç™»å…¥éçš„ç©å®¶æŒ‰ç™»å…¥å³å¯
                 window.location.href = 'hub.html';
            }
        });

        socket.on('disconnect', () => {
            statusSpan.innerText = "Offline";
            statusSpan.style.color = "red";
        });

        // 2. æ¥æ”¶ç™»å…¥/è¨»å†Šçµæœ
        socket.on('authResult', (res) => {
            if (res.success) {
                msgDiv.style.color = "#27ae60";
                msgDiv.innerText = "âœ… " + res.msg;
                
                if (res.token) {
                    localStorage.setItem('rpg_token', res.token);
                    setTimeout(() => {
                        window.location.href = 'hub.html';
                    }, 1000);
                } else {
                    // å¦‚æœæ˜¯è¨»å†ŠæˆåŠŸï¼Œæç¤ºå»ç™»å…¥
                    msgDiv.innerText = "âœ… è¨»å†ŠæˆåŠŸï¼è«‹é»æ“Šã€Œç™»å…¥ã€";
                }
            } else {
                msgDiv.style.color = "#c0392b";
                msgDiv.innerText = "âŒ " + res.msg;
            }
        });

        function doAuth(type) {
            const user = document.getElementById('user').value.trim();
            const pass = document.getElementById('pass').value.trim();
            
            if (!socket.connected) {
                msgDiv.innerText = "âš ï¸ ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨";
                return;
            }

            if (user.length < 3 || pass.length < 3) {
                msgDiv.innerText = "âš ï¸ å¸³è™Ÿå¯†ç¢¼å¤ªçŸ­";
                return;
            }

            msgDiv.innerText = "è™•ç†ä¸­...";
            socket.emit(type, { user, pass });
        }
    </script>
</body>
</html>
