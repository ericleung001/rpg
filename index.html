<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>勇者物語 - 登入v2</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body { 
            background-color: #2c3e50; color: #fff; 
            font-family: 'Press Start 2P', monospace; 
            text-align: center; 
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            height: 100dvh; margin: 0; 
            overscroll-behavior: none;
        }

        .login-card {
            background: #34495e; border: 4px solid #fff; 
            padding: 30px 20px; width: 90%; max-width: 400px; 
            border-radius: 12px; box-sizing: border-box;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        h1 { 
            font-size: 24px; margin-bottom: 30px; 
            color: #f1c40f; text-shadow: 2px 2px #000; 
            line-height: 1.5;
        }

        .input-group { margin-bottom: 20px; text-align: left; }
        
        label { 
            display: block; margin-bottom: 8px; 
            font-size: 12px; color: #bdc3c7; 
        }

        input { 
            width: 100%; padding: 15px; 
            font-family: inherit; font-size: 16px; 
            background: #2c3e50; border: 2px solid #95a5a6; 
            color: #fff; box-sizing: border-box; 
            outline: none; border-radius: 6px;
        }
        input:focus { border-color: #3498db; }

        .btn-group { 
            display: flex; flex-direction: column; gap: 15px; margin-top: 30px; 
        }

        .btn { 
            padding: 18px; font-family: inherit; font-size: 16px; 
            cursor: pointer; color: white; border: none; 
            border-radius: 8px; font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }

        .btn-login { background: #27ae60; border: 2px solid #2ecc71; }
        .btn-register { background: #2980b9; border: 2px solid #3498db; }

        #msg { 
            margin-top: 20px; min-height: 20px; 
            font-size: 12px; color: #e74c3c; 
        }
    </style>
</head>
<body>

    <div class="login-card">
        <h1>⚔️ 勇者物語 ️<br><span style="font-size:12px; color:#fff;">ONLINE</span></h1>
        
        <div class="input-group">
            <label>帳號 / Username (最少5位)</label>
            <input type="text" id="username" placeholder="輸入帳號..." maxlength="12">
        </div>
        
        <div class="input-group">
            <label>密碼 / Password (最少5位)</label>
            <input type="password" id="password" placeholder="輸入密碼..." maxlength="20">
        </div>

        <div id="msg"></div>

        <div class="btn-group">
            <button class="btn btn-login" onclick="doLogin()">登入 (Login)</button>
            <button class="btn btn-register" onclick="doRegister()">註冊 (Register)</button>
        </div>
    </div>

    <script src="socket.io.js"></script>
    <script>
        //  替換成你真正的後端網址 (記得要用 https / wss)
		// 這是加密後的網址 (一般人看不懂這是什麼)
		const BACKEND_URL = "http://45.76.107.112:3001"; 
        
        const socket = io(BACKEND_URL, {
            transports: ['websocket', 'polling']
        });

        if(localStorage.getItem('rpg_token')) {
            window.location.href = 'hub.html';
        }

        socket.on('authResult', (res) => {
            if (res.success) {
                if (res.token) {
                    localStorage.setItem('rpg_token', res.token);
                    document.getElementById('msg').style.color = '#2ecc71';
                    document.getElementById('msg').innerText = "登入成功！轉跳中...";
                    setTimeout(() => window.location.href = 'hub.html', 500);
                } else {
                    document.getElementById('msg').style.color = '#2ecc71';
                    document.getElementById('msg').innerText = "註冊成功！請點擊登入。";
                }
            } else {
                document.getElementById('msg').style.color = '#e74c3c';
                document.getElementById('msg').innerText = res.msg;
                // 震動特效
                document.querySelector('.login-card').animate([
                    { transform: 'translateX(0)' }, { transform: 'translateX(-10px)' }, 
                    { transform: 'translateX(10px)' }, { transform: 'translateX(0)' }
                ], { duration: 300 });
            }
        });

        function doLogin() {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();
            
            if(!u || !p) { showMsg("請輸入帳號密碼"); return; }
            if(u.length < 5) { showMsg("帳號至少需 5 個字元"); return; }
            if(p.length < 5) { showMsg("密碼至少需 5 個字元"); return; }

            socket.emit('login', { user: u, pass: p });
        }

        function doRegister() {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();
            
            if(!u || !p) { showMsg("請輸入帳號密碼"); return; }
            if(u.length < 5) { showMsg("帳號至少需 5 個字元"); return; }
            if(p.length < 5) { showMsg("密碼至少需 5 個字元"); return; }

            socket.emit('register', { user: u, pass: p });
        }

        function showMsg(text) {
            document.getElementById('msg').innerText = text;
        }
    </script>
</body>
</html>
