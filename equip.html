<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>裝備管理</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { 
            background-color: #2c3e50; color: #fff; 
            font-family: 'Press Start 2P', monospace; 
            text-align: center; padding: 15px; 
            display:flex; flex-direction:column; align-items:center; 
            height: 100dvh; margin:0; box-sizing:border-box; overscroll-behavior: none;
		overflow: scroll;
        }
        .main-box { background: #34495e; border: 4px solid #fff; padding: 15px; width: 100%; max-width: 600px; border-radius: 12px; box-sizing: border-box; flex: 1; display: flex; flex-direction: column;}
        h2 { font-size: 18px; margin: 0 0 15px 0; }
        .stats-display { text-align: left; margin-bottom: 15px; font-size: 12px; line-height: 2; border-bottom: 2px solid #555; padding-bottom: 10px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .slots-area { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; background: #2c3e50; padding: 10px; border: 2px solid #bdc3c7; border-radius: 8px;}
        .slot { border: 2px dashed #95a5a6; padding: 10px 5px; min-height: 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .slot-title { font-size: 10px; color: #f1c40f; margin-bottom: 5px; }
        .slot-item { font-size: 10px; color: #fff; text-align: center; line-height: 1.2; }
        h3 { font-size: 14px; margin: 10px 0; text-align: left; color: #bdc3c7; }
        .inventory-container { flex: 1; overflow-y: auto; border: 2px solid #3498db; background: #2c3e50; padding: 5px; border-radius: 8px;}
        .inv-item { background: #34495e; border-bottom: 1px solid #555; padding: 12px; display: flex; justify-content: space-between; align-items: center; text-align: left; margin-bottom: 5px;}
        .inv-name { font-size: 12px; color: #fff; margin-bottom: 3px; }
        .inv-desc { font-size: 10px; color: #bdc3c7; }
        .btn { background: #27ae60; color: white; border: 2px solid #2ecc71; padding: 8px 12px; cursor: pointer; font-family: inherit; font-size: 12px; border-radius: 4px;}
        .btn-unequip { background: #c0392b; border-color: #e74c3c; margin-top: 5px; font-size: 10px; padding: 5px 8px; }
        .back-btn { background: #7f8c8d; color: white; padding: 15px; text-decoration: none; font-size: 14px; display: block; width: 100%; max-width: 600px; box-sizing: border-box; border-radius: 8px; margin-top: 15px; border: 3px solid #fff;}
        /* === 通用通知條樣式 (加在所有頁面的 style 裡) === */
        #game-toast {
            position: fixed; 
            top: -100px; /* 預設藏在螢幕上面 */
            left: 50%; 
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #f1c40f; /* 金色邊框 */
            color: #fff;
            padding: 15px 30px;
            border-radius: 30px;
            z-index: 9999; /* 確保在最上層 */
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            transition: top 0.5s ease-in-out; /* 滑動動畫 */
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            pointer-events: none; /* 讓點擊穿透，不會擋住操作 */
        }
    </style>
</head>
<body>
<div id="game-toast"></div>
    <div class="main-box">
        <h2>ߛ᯸㝥♧뀦勼/h2>
        <div class="stats-display">
            <div class="stat-grid">
                <div>⚔️ ATK: <span id="atk" style="color:#e74c3c">0</span></div>
                <div>ߛ᯸EF: <span id="def" style="color:#3498db">0</span></div>
                <div>❤️ HP : <span id="hp">0</span></div>
                <div>ߒ砍P : <span id="mp">0</span></div>
            </div>
        </div>
        <div class="slots-area">
            <div class="slot"><div class="slot-title">武器 (Weapon)</div><div id="slot-weapon" class="slot-item">無</div></div>
            <div class="slot"><div class="slot-title">防具 (Armor)</div><div id="slot-armor" class="slot-item">無</div></div>
            <div class="slot"><div class="slot-title">飾品 (Acc)</div><div id="slot-acc" class="slot-item">無</div></div>
        </div>
        <h3>ߎ⠨㌥셠(點擊裝備)</h3>
        <div id="inventory-list" class="inventory-container"><div style="font-size:12px; color:#aaa; padding:10px;">讀取中...</div></div>
    </div>
    <a href="hub.html" class="back-btn">◀ 返回大廳</a>

    <script src="socket.io.js"></script>
    <script>
const socket = io('https://mmo.ttctv-105.cc', { 
    transports: ['websocket', 'polling'],
    secure: true // 因為你用 https，建議加呢個
});
        let myToken = localStorage.getItem('rpg_token');
        if (!myToken) window.location.href = 'index.html';

        // ߟ⠥崨㝥♥藨ᨠ(含 Lv.201 - Lv.300 神裝)
        const ITEM_MAP = {
            // === 武器 ===
            'wood_sword':       { name: "木劍", cost: 100, desc: "ATK+10" },
            'copper_dagger':    { name: "銅匕首", cost: 400, desc: "ATK+20" }, 
            'iron_sword':       { name: "鐵劍", cost: 1500, desc: "ATK+60" }, 
            'silver_blade':     { name: "銀刃", cost: 4000, desc: "ATK+100" },
            'spike_club':       { name: "狼牙棒", cost: 0, desc: "ATK+140 HP+300" }, 
            'poison_dag':       { name: "劇毒匕首", cost: 0, desc: "ATK+160" }, 
            'shark_tooth':      { name: "鯊魚牙匕首", cost: 800, desc: "ATK+80" },
            'flame_staff':      { name: "火焰法杖", cost: 0, desc: "ATK+300 MP+100" }, 
            'emerald_staff':    { name: "翡翠法杖", cost: 5000, desc: "ATK+300" },
            'gold_axe':         { name: "黃金巨斧", cost: 10000, desc: "ATK+500" },
            'obsidian_blade':   { name: "黑曜石之劍", cost: 8000, desc: "ATK+600" },
            'frost_bow':        { name: "寒冰弓", cost: 0, desc: "ATK+1300" }, 
            'dragon_spear':     { name: "龍骨長槍", cost: 15000, desc: "ATK+1200" },
            'mithril_saber':    { name: "秘銀軍刀", cost: 50000, desc: "ATK+2000" },
            'void_reaper':      { name: "虛空收割者", cost: 0, desc: "ATK+3500" },
            'void_reaper_dark': { name: "闇·虛空收割者", cost: 0, desc: "ATK+5500" }, 
            'god_slayer':       { name: "弒神劍", cost: 0, desc: "ATK+20000 HP+4000" }, 
            'chaos_staff':      { name: "混沌法杖", cost: 0, desc: "ATK+25000 MP+300" }, 
            'hero_sword':       { name: "勇者之劍", cost: 0, desc: "ATK+50" },
            'steel_blade':      { name: "精鋼劍", cost: 0, desc: "ATK+25" },
            'assassin_dag':     { name: "刺客短刀", cost: 0, desc: "ATK+120" },
            'genesis_weapon':   { name: "創世·終焉之劍", cost: 0, desc: "ATK+50000 HP+20000" }, 
            
            // ߟ⠛新增] Lv.230 - 300 新武器
            'void_blade':       { name: "虛空之刃", cost: 0, desc: "ATK+75000 HP+80000" }, 
            'galaxy_saber':     { name: "銀河光劍", cost: 0, desc: "ATK+110000 HP+150000" }, 
            'entropy_sword':    { name: "終焉·熱寂之劍", cost: 0, desc: "ATK+200000 HP+300000" },
            
            // 採集武器
            'oak_bow':          { name: "橡木弓", cost: 200, desc: "ATK+25" },
            'maple_staff':      { name: "楓木法杖", cost: 500, desc: "ATK+50" },

            // === 防具 ===
            'cloth_armor':      { name: "布衣", cost: 100, desc: "DEF+5" },
            'hunt_vest':        { name: "獵人背心", cost: 0, desc: "DEF+25 HP+200" },
            'leather_armor':    { name: "皮甲", cost: 400, desc: "DEF+15" }, 
            'plate_mail':       { name: "板金甲", cost: 0, desc: "DEF+15" },
            'dragon_mail':      { name: "龍鱗甲", cost: 0, desc: "DEF+30" },
            'chain_mail':       { name: "鎖子甲", cost: 1500, desc: "DEF+40" }, 
            'iron_armor':       { name: "鐵盔甲", cost: 4000, desc: "DEF+100" }, 
            'magma_plate':      { name: "熔岩胸甲", cost: 0, desc: "DEF+150 HP+1500" }, 
            'ice_robe':         { name: "冰霜法袍", cost: 0, desc: "DEF+200 MP+500" },
            'yeti_cloak':       { name: "雪怪斗篷", cost: 0, desc: "DEF+350 HP+4000" }, 
            'demon_armor':      { name: "惡魔戰甲", cost: 0, desc: "DEF+1000 HP+12000" }, 
            'angel_armor':      { name: "熾天使鎧甲", cost: 0, desc: "DEF+5000 HP+50000" },
            'genesis_armor':    { name: "創世·神之庇護", cost: 0, desc: "DEF+20000 HP+150000" }, 

            // ߟ⠛新增] Lv.230 - 300 新防具
            'void_armor':       { name: "虛空戰甲", cost: 0, desc: "DEF+45000 HP+300000" }, 
            'nebula_plate':     { name: "星雲板甲", cost: 0, desc: "DEF+70000 HP+600000" }, 
            'entropy_god_armor':{ name: "終焉·神之庇護", cost: 0, desc: "DEF+120000 HP+1500000" },

            // === 飾品 ===
            'bone_ring':        { name: "骨戒", cost: 0, desc: "ATK+15 HP+200" }, 
            'ring_str':         { name: "力量戒指", cost: 3000, desc: "ATK+30" },
            'bracelet_def':     { name: "堅毅手環", cost: 3000, desc: "DEF+30" }, 
            'necklace_hp':      { name: "紅水晶項鍊", cost: 5000, desc: "HP+250" }, 
            'necklace_mp':      { name: "藍水晶項鍊", cost: 5000, desc: "MP+60" }, 
            'snake_boots':      { name: "蛇皮長靴", cost: 0, desc: "DEF+30 HP+200" }, 
            'fish_ring':        { name: "魚鱗戒指", cost: 400, desc: "DEF+50 HP+500" }, 
            'pearl_necklace':   { name: "珍珠項鍊", cost: 2000, desc: "DEF+20 MP+150" }, 
            'amulet_soul':      { name: "靈魂護符", cost: 0, desc: "MP+300 HP+1000" },
            'ring_lord':        { name: "領主指環", cost: 0, desc: "全能力+600" }, 
            'crown_chaos':      { name: "混沌之冠", cost: 0, desc: "全能力+2000" },
            'ring_galaxy':      { name: "銀河指環", cost: 0, desc: "全能力+5000" }, 
            'ring_life':        { name: "生命護符", cost: 0, desc: "HP+100" },
            'ring_magic':       { name: "魔力耳環", cost: 0, desc: "MP+50" },

            // ߟ⠛新增] Lv.280 新飾品
            'dimension_ring':   { name: "維度指環", cost: 0, desc: "全能力+15000" }
        };

        socket.on('connect', () => { socket.emit('joinGame', myToken); });
        socket.on('playerStatsUpdate', (p) => { renderStats(p); renderSlots(p.equipment); renderInventory(p.inventory); });
        socket.on('equipResult', (msg) => { showMsg(msg); });
        
        socket.on('errorMessage', (msg) => { showMsg("❌ " + msg); });

        function renderStats(p) {
            document.getElementById('atk').innerText = p.atk;
            document.getElementById('def').innerText = p.def;
            document.getElementById('hp').innerText = p.maxHp;
            document.getElementById('mp').innerText = p.maxMp;
        }

        function renderSlots(eq) {
            const types = ['weapon', 'armor', 'acc'];
            types.forEach(type => {
                const div = document.getElementById(`slot-${type}`);
                const itemId = eq[type];
                if (itemId && ITEM_MAP[itemId]) {
                    div.innerHTML = `<div style="color:#2ecc71; margin-bottom:5px;">${ITEM_MAP[itemId].name}</div><button class="btn btn-unequip" onclick="unequip('${type}')">卸下</button>`;
                } else {
                    div.innerHTML = `<span style="color:#7f8c8d">無</span>`;
                }
            });
        }

        function renderInventory(inv) {
            const list = document.getElementById('inventory-list');
            list.innerHTML = '';
            let hasEquipable = false;
            Object.keys(inv).forEach(key => {
                const item = ITEM_MAP[key];
                if (item && inv[key] > 0) {
                    hasEquipable = true;
                    const div = document.createElement('div');
                    div.className = 'inv-item';
                    div.innerHTML = `<div><div class="inv-name">${item.name} x${inv[key]}</div><div class="inv-desc">${item.desc}</div></div><button class="btn" onclick="equip('${key}')">裝備</button>`;
                    list.appendChild(div);
                }
            });
            if (!hasEquipable) list.innerHTML = `<div style="color:#7f8c8d; font-size:12px; padding:20px;">背包沒有可裝備的物品<br>(如藥水請至背包查看)</div>`;
        }

        function equip(id) { socket.emit('equipItem', id); }
        function unequip(slot) { socket.emit('unequipItem', slot); }
        
        function showMsg(text) {
            const toast = document.getElementById('game-toast');
            toast.innerText = text;
            toast.style.top = "30px"; 
            setTimeout(() => {
                toast.style.top = "-100px"; 
            }, 3000);
        }
    </script>
</body>
</html>