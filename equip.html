<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>裝備管理</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { 
            background-color: #2c3e50; color: #fff; 
            font-family: 'Press Start 2P', monospace; 
            text-align: center; padding: 15px; 
            display:flex; flex-direction:column; align-items:center; 
            height: 100dvh; margin:0; box-sizing:border-box; overscroll-behavior: none;
        }
        .main-box { background: #34495e; border: 4px solid #fff; padding: 15px; width: 100%; max-width: 600px; border-radius: 12px; box-sizing: border-box; flex: 1; display: flex; flex-direction: column;}
        h2 { font-size: 18px; margin: 0 0 15px 0; }
        .stats-display { text-align: left; margin-bottom: 15px; font-size: 12px; line-height: 2; border-bottom: 2px solid #555; padding-bottom: 10px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .slots-area { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; background: #2c3e50; padding: 10px; border: 2px solid #bdc3c7; border-radius: 8px;}
        .slot { border: 2px dashed #95a5a6; padding: 10px 5px; min-height: 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .slot-title { font-size: 10px; color: #f1c40f; margin-bottom: 5px; }
        .slot-item { font-size: 10px; color: #fff; text-align: center; line-height: 1.2; }
        h3 { font-size: 14px; margin: 10px 0; text-align: left; color: #bdc3c7; }
        .inventory-container { flex: 1; overflow-y: auto; border: 2px solid #3498db; background: #2c3e50; padding: 5px; border-radius: 8px;}
        .inv-item { background: #34495e; border-bottom: 1px solid #555; padding: 12px; display: flex; justify-content: space-between; align-items: center; text-align: left; margin-bottom: 5px;}
        .inv-name { font-size: 12px; color: #fff; margin-bottom: 3px; }
        .inv-desc { font-size: 10px; color: #bdc3c7; }
        .btn { background: #27ae60; color: white; border: 2px solid #2ecc71; padding: 8px 12px; cursor: pointer; font-family: inherit; font-size: 12px; border-radius: 4px;}
        .btn-unequip { background: #c0392b; border-color: #e74c3c; margin-top: 5px; font-size: 10px; padding: 5px 8px; }
        .back-btn { background: #7f8c8d; color: white; padding: 15px; text-decoration: none; font-size: 14px; display: block; width: 100%; max-width: 600px; box-sizing: border-box; border-radius: 8px; margin-top: 15px; border: 3px solid #fff;}
    	/* === 通用通知條樣式 (加在所有頁面的 style 裡) === */
        #game-toast {
            position: fixed; 
            top: -100px; /* 預設藏在螢幕上面 */
            left: 50%; 
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #f1c40f; /* 金色邊框 */
            color: #fff;
            padding: 15px 30px;
            border-radius: 30px;
            z-index: 9999; /* 確保在最上層 */
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            transition: top 0.5s ease-in-out; /* 滑動動畫 */
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            pointer-events: none; /* 讓點擊穿透，不會擋住操作 */
        }
    </style>
</head>
<body>
<div id="game-toast"></div>
    <div class="main-box">
        <h2>️ 裝備狀態</h2>
        <div class="stats-display">
            <div class="stat-grid">
                <div>⚔️ ATK: <span id="atk" style="color:#e74c3c">0</span></div>
                <div>️ DEF: <span id="def" style="color:#3498db">0</span></div>
                <div>❤️ HP : <span id="hp">0</span></div>
                <div> MP : <span id="mp">0</span></div>
            </div>
        </div>
        <div class="slots-area">
            <div class="slot"><div class="slot-title">武器 (Weapon)</div><div id="slot-weapon" class="slot-item">無</div></div>
            <div class="slot"><div class="slot-title">防具 (Armor)</div><div id="slot-armor" class="slot-item">無</div></div>
            <div class="slot"><div class="slot-title">飾品 (Acc)</div><div id="slot-acc" class="slot-item">無</div></div>
        </div>
        <h3> 背包 (點擊裝備)</h3>
        <div id="inventory-list" class="inventory-container"><div style="font-size:12px; color:#aaa; padding:10px;">讀取中...</div></div>
    </div>
    <a href="hub.html" class="back-btn">◀ 返回大廳</a>

    <script src="socket.io.js"></script>
    <script>
        // 這是加密後的網址 (一般人看不懂這是什麼)
        const _0x5a1b = "aHR0cHM6Ly9tbW8udHRjdHYtMTA1LmNj"; 

        // atob() 函數會把亂碼解開成原本的網址
        const BACKEND_URL = atob(_0x5a1b); 
        
        const socket = io(BACKEND_URL, {
            transports: ['websocket', 'polling']
        });
        let myToken = localStorage.getItem('rpg_token');
        if (!myToken) window.location.href = 'index.html';

        const ITEM_MAP = {
            // === 武器 ===
            'wood_sword':   { name: "木劍", cost: 100, desc: "ATK+10" },
            'copper_dagger':{ name: "銅匕首", cost: 200, desc: "ATK+15" },
            'iron_sword':   { name: "鐵劍", cost: 500, desc: "ATK+30" },
            'spike_club':   { name: "狼牙棒", cost: 0, desc: "ATK+55" },
            'poison_dag':   { name: "劇毒匕首", cost: 0, desc: "ATK+60" },
            'silver_blade': { name: "銀刃", cost: 2000, desc: "ATK+150" },
            'flame_staff':  { name: "火焰法杖", cost: 0, desc: "ATK+200" },
            'gold_axe':     { name: "黃金巨斧", cost: 10000, desc: "ATK+500" },
            'frost_bow':    { name: "寒冰弓", cost: 0, desc: "ATK+650" },
            'mithril_saber':{ name: "秘銀軍刀", cost: 50000, desc: "ATK+2000" },
            'void_reaper':  { name: "虛空收割者", cost: 0, desc: "ATK+3500" },
            'god_slayer':   { name: "弒神劍", cost: 0, desc: "ATK+20000" },
            'chaos_staff':  { name: "混沌法杖", cost: 0, desc: "ATK+25000" },
            'hero_sword':   { name: "勇者之劍", cost: 2000, desc: "ATK+50" },
            'steel_blade':  { name: "精鋼劍", cost: 0, desc: "ATK+25" },
            'assassin_dag': { name: "刺客短刀", cost: 2000, desc: "ATK+120" },

            // === 防具 ===
            'cloth_armor':  { name: "布衣", cost: 100, desc: "DEF+5" },
            'hunt_vest':    { name: "獵人背心", cost: 0, desc: "DEF+8" },
            'leather_armor':{ name: "皮甲", cost: 400, desc: "DEF+15" },
            'chain_mail':   { name: "鎖子甲", cost: 1500, desc: "DEF+40" },
            'magma_plate':  { name: "熔岩胸甲", cost: 0, desc: "DEF+100" },
            'ice_robe':     { name: "冰霜法袍", cost: 0, desc: "DEF+200" },
            'yeti_cloak':   { name: "雪怪斗篷", cost: 0, desc: "DEF+250" },
            'demon_armor':  { name: "惡魔戰甲", cost: 0, desc: "DEF+1000" },
            'angel_armor':  { name: "熾天使鎧甲", cost: 0, desc: "DEF+5000" },
            'plate_mail':   { name: "板金甲", cost: 1500, desc: "DEF+15" },
            'dragon_mail':  { name: "龍鱗甲", cost: 0, desc: "DEF+30" },

            // === 飾品 ===
            'bone_ring':    { name: "骨戒", cost: 0, desc: "ATK+2" },
            'ring_str':     { name: "力量戒指", cost: 300, desc: "ATK+10" },
            'snake_boots':  { name: "蛇皮長靴", cost: 0, desc: "DEF+10" },
            'amulet_soul':  { name: "靈魂護符", cost: 0, desc: "MP+300" },
            'ring_lord':    { name: "領主指環", cost: 0, desc: "全能力+500" },
            'crown_chaos':  { name: "混沌之冠", cost: 0, desc: "全能力+2000" },
            'ring_life':    { name: "生命護符", cost: 600, desc: "HP+100" },
            'ring_magic':   { name: "魔力耳環", cost: 500, desc: "MP+50" }
        };

        socket.on('connect', () => { socket.emit('joinGame', myToken); });
        socket.on('playerStatsUpdate', (p) => { renderStats(p); renderSlots(p.equipment); renderInventory(p.inventory); });
        socket.on('equipResult', (msg) => { showMsg(msg); });
        
        // 【新增】監聽錯誤訊息
        socket.on('errorMessage', (msg) => { showMsg("❌ " + msg); });

        function renderStats(p) {
            document.getElementById('atk').innerText = p.atk;
            document.getElementById('def').innerText = p.def;
            document.getElementById('hp').innerText = p.maxHp;
            document.getElementById('mp').innerText = p.maxMp;
        }

        function renderSlots(eq) {
            const types = ['weapon', 'armor', 'acc'];
            types.forEach(type => {
                const div = document.getElementById(`slot-${type}`);
                const itemId = eq[type];
                if (itemId && ITEM_MAP[itemId]) {
                    div.innerHTML = `<div style="color:#2ecc71; margin-bottom:5px;">${ITEM_MAP[itemId].name}</div><button class="btn btn-unequip" onclick="unequip('${type}')">卸下</button>`;
                } else {
                    div.innerHTML = `<span style="color:#7f8c8d">無</span>`;
                }
            });
        }

        function renderInventory(inv) {
            const list = document.getElementById('inventory-list');
            list.innerHTML = '';
            let hasEquipable = false;
            Object.keys(inv).forEach(key => {
                const item = ITEM_MAP[key];
                if (item && inv[key] > 0) {
                    hasEquipable = true;
                    const div = document.createElement('div');
                    div.className = 'inv-item';
                    div.innerHTML = `<div><div class="inv-name">${item.name} x${inv[key]}</div><div class="inv-desc">${item.desc}</div></div><button class="btn" onclick="equip('${key}')">裝備</button>`;
                    list.appendChild(div);
                }
            });
            if (!hasEquipable) list.innerHTML = `<div style="color:#7f8c8d; font-size:12px; padding:20px;">背包沒有可裝備的物品<br>(如藥水請至背包查看)</div>`;
        }

        function equip(id) { socket.emit('equipItem', id); }
        function unequip(slot) { socket.emit('unequipItem', slot); }
        // === 通用顯示訊息函數 ===
        function showMsg(text) {
            const toast = document.getElementById('game-toast');
            toast.innerText = text;
            toast.style.top = "30px"; // 滑下來顯示
            
            // 3秒後自動收回
            setTimeout(() => {
                toast.style.top = "-100px"; 
            }, 3000);
        }
    </script>
</body>
</html>
