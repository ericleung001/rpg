<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è£å‚™ç®¡ç†</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { 
            background-color: #2c3e50; color: #fff; 
            font-family: 'Press Start 2P', monospace; 
            text-align: center; padding: 15px; 
            display:flex; flex-direction:column; align-items:center; 
            height: 100dvh; margin:0; box-sizing:border-box; overscroll-behavior: none;
        }
        .main-box { background: #34495e; border: 4px solid #fff; padding: 15px; width: 100%; max-width: 600px; border-radius: 12px; box-sizing: border-box; flex: 1; display: flex; flex-direction: column;}
        h2 { font-size: 18px; margin: 0 0 15px 0; }
        .stats-display { text-align: left; margin-bottom: 15px; font-size: 12px; line-height: 2; border-bottom: 2px solid #555; padding-bottom: 10px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .slots-area { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; background: #2c3e50; padding: 10px; border: 2px solid #bdc3c7; border-radius: 8px;}
        .slot { border: 2px dashed #95a5a6; padding: 10px 5px; min-height: 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .slot-title { font-size: 10px; color: #f1c40f; margin-bottom: 5px; }
        .slot-item { font-size: 10px; color: #fff; text-align: center; line-height: 1.2; }
        h3 { font-size: 14px; margin: 10px 0; text-align: left; color: #bdc3c7; }
        .inventory-container { flex: 1; overflow-y: auto; border: 2px solid #3498db; background: #2c3e50; padding: 5px; border-radius: 8px;}
        .inv-item { background: #34495e; border-bottom: 1px solid #555; padding: 12px; display: flex; justify-content: space-between; align-items: center; text-align: left; margin-bottom: 5px;}
        .inv-name { font-size: 12px; color: #fff; margin-bottom: 3px; }
        .inv-desc { font-size: 10px; color: #bdc3c7; }
        .btn { background: #27ae60; color: white; border: 2px solid #2ecc71; padding: 8px 12px; cursor: pointer; font-family: inherit; font-size: 12px; border-radius: 4px;}
        .btn-unequip { background: #c0392b; border-color: #e74c3c; margin-top: 5px; font-size: 10px; padding: 5px 8px; }
        .back-btn { background: #7f8c8d; color: white; padding: 15px; text-decoration: none; font-size: 14px; display: block; width: 100%; max-width: 600px; box-sizing: border-box; border-radius: 8px; margin-top: 15px; border: 3px solid #fff;}
        /* === é€šç”¨é€šçŸ¥æ¢æ¨£å¼ (åŠ åœ¨æ‰€æœ‰é é¢çš„ style è£¡) === */
        #game-toast {
            position: fixed; 
            top: -100px; /* é è¨­è—åœ¨è¢å¹•ä¸Šé¢ */
            left: 50%; 
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #f1c40f; /* é‡‘è‰²é‚Šæ¡† */
            color: #fff;
            padding: 15px 30px;
            border-radius: 30px;
            z-index: 9999; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            transition: top 0.5s ease-in-out; /* æ»‘å‹•å‹•ç•« */
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            pointer-events: none; /* è®“é»æ“Šç©¿é€ï¼Œä¸æœƒæ“‹ä½æ“ä½œ */
        }
    </style>
</head>
<body>
<div id="game-toast"></div>
    <div class="main-box">
        <h2>ğŸ›¡ï¸ è£å‚™ç‹€æ…‹</h2>
        <div class="stats-display">
            <div class="stat-grid">
                <div>âš”ï¸ ATK: <span id="atk" style="color:#e74c3c">0</span></div>
                <div>ğŸ›¡ï¸ DEF: <span id="def" style="color:#3498db">0</span></div>
                <div>â¤ï¸ HP : <span id="hp">0</span></div>
                <div>ğŸ’§ MP : <span id="mp">0</span></div>
            </div>
        </div>
        <div class="slots-area">
            <div class="slot"><div class="slot-title">æ­¦å™¨ (Weapon)</div><div id="slot-weapon" class="slot-item">ç„¡</div></div>
            <div class="slot"><div class="slot-title">é˜²å…· (Armor)</div><div id="slot-armor" class="slot-item">ç„¡</div></div>
            <div class="slot"><div class="slot-title">é£¾å“ (Acc)</div><div id="slot-acc" class="slot-item">ç„¡</div></div>
        </div>
        <h3>ğŸ’ èƒŒåŒ… (é»æ“Šè£å‚™)</h3>
        <div id="inventory-list" class="inventory-container"><div style="font-size:12px; color:#aaa; padding:10px;">è®€å–ä¸­...</div></div>
    </div>
    <a href="hub.html" class="back-btn">â—€ è¿”å›å¤§å»³</a>

    <script src="socket.io.js"></script>
    <script>
		const _0x5a1b = "aHR0cHM6Ly9ycGdnYW1lc2VyLmNj"; 
		const BACKEND_URL = atob(_0x5a1b);
		
		const socket = io(BACKEND_URL, {
		    transports: ['websocket', 'polling'],
		    secure: true // ğŸ”’ å¼·åˆ¶ä½¿ç”¨åŠ å¯†é€£ç·š (HTTPS/WSS)
		});
        let myToken = localStorage.getItem('rpg_token');
        if (!myToken) window.location.href = 'index.html';

        // ğŸŸ¢ å®Œæ•´è£å‚™åˆ—è¡¨ (å·²åŒæ­¥ Server æœ€æ–°è¨­å®š)
        const ITEM_MAP = {
            // === æ­¦å™¨ ===
            'wood_sword':   { name: "æœ¨åŠ", cost: 100, desc: "ATK+10" },
            'copper_dagger':{ name: "éŠ…åŒ•é¦–", cost: 200, desc: "ATK+15" },
            'iron_sword':   { name: "éµåŠ", cost: 500, desc: "ATK+30" },
            'spike_club':   { name: "ç‹¼ç‰™æ£’", cost: 0, desc: "ATK+55" },
            'poison_dag':   { name: "åŠ‡æ¯’åŒ•é¦–", cost: 0, desc: "ATK+60" },
            'silver_blade': { name: "éŠ€åˆƒ", cost: 2000, desc: "ATK+150" },
            'flame_staff':  { name: "ç«ç„°æ³•æ–", cost: 0, desc: "ATK+200" },
            'gold_axe':     { name: "é»ƒé‡‘å·¨æ–§", cost: 10000, desc: "ATK+500" },
            'frost_bow':    { name: "å¯’å†°å¼“", cost: 0, desc: "ATK+650" },
            'mithril_saber':{ name: "ç§˜éŠ€è»åˆ€", cost: 50000, desc: "ATK+2000" },
            'void_reaper':  { name: "è™›ç©ºæ”¶å‰²è€…", cost: 0, desc: "ATK+3500" },
            'god_slayer':   { name: "å¼’ç¥åŠ", cost: 0, desc: "ATK+20000" },
            'chaos_staff':  { name: "æ··æ²Œæ³•æ–", cost: 0, desc: "ATK+25000" },
            'hero_sword':   { name: "å‹‡è€…ä¹‹åŠ", cost: 2000, desc: "ATK+50" },
            'steel_blade':  { name: "ç²¾é‹¼åŠ", cost: 0, desc: "ATK+25" },
            'assassin_dag': { name: "åˆºå®¢çŸ­åˆ€", cost: 2000, desc: "ATK+120" },
            // æ–°å¢æ¡é›†æ­¦å™¨
            'oak_bow':      { name: "æ©¡æœ¨å¼“", cost: 200, desc: "ATK+25" },
            'maple_staff':  { name: "æ¥“æœ¨æ³•æ–", cost: 500, desc: "ATK+50" },
            'shark_tooth':  { name: "é¯Šé­šç‰™åŒ•é¦–", cost: 800, desc: "ATK+80" },
            'emerald_staff':{ name: "ç¿¡ç¿ æ³•æ–", cost: 5000, desc: "ATK+300" },
            'obsidian_blade':{ name: "é»‘æ›œçŸ³ä¹‹åŠ", cost: 8000, desc: "ATK+600" },
            'dragon_spear': { name: "é¾éª¨é•·æ§", cost: 15000, desc: "ATK+1200" },

            // === é˜²å…· ===
            'cloth_armor':  { name: "å¸ƒè¡£", cost: 100, desc: "DEF+5" },
            'hunt_vest':    { name: "çµäººèƒŒå¿ƒ", cost: 0, desc: "DEF+8" },
            'leather_armor':{ name: "çš®ç”²", cost: 400, desc: "DEF+15" },
            'chain_mail':   { name: "é–å­ç”²", cost: 1500, desc: "DEF+40" },
            'magma_plate':  { name: "ç†”å²©èƒ¸ç”²", cost: 0, desc: "DEF+100" },
            'ice_robe':     { name: "å†°éœœæ³•è¢", cost: 0, desc: "DEF+200" },
            'yeti_cloak':   { name: "é›ªæ€ªæ–—ç¯·", cost: 0, desc: "DEF+250" },
            'demon_armor':  { name: "æƒ¡é­”æˆ°ç”²", cost: 0, desc: "DEF+1000" },
            'angel_armor':  { name: "ç†¾å¤©ä½¿é§ç”²", cost: 0, desc: "DEF+5000" },
            'plate_mail':   { name: "æ¿é‡‘ç”²", cost: 1500, desc: "DEF+15" },
            'dragon_mail':  { name: "é¾é±—ç”²", cost: 0, desc: "DEF+30" },

            // === é£¾å“ ===
            'bone_ring':    { name: "éª¨æˆ’", cost: 0, desc: "ATK+2" },
            'ring_str':     { name: "åŠ›é‡æˆ’æŒ‡", cost: 300, desc: "ATK+10" },
            'snake_boots':  { name: "è›‡çš®é•·é´", cost: 0, desc: "DEF+10" },
            'amulet_soul':  { name: "éˆé­‚è­·ç¬¦", cost: 0, desc: "MP+300" },
            'ring_lord':    { name: "é ˜ä¸»æŒ‡ç’°", cost: 0, desc: "å…¨èƒ½åŠ›+500" },
            'crown_chaos':  { name: "æ··æ²Œä¹‹å† ", cost: 0, desc: "å…¨èƒ½åŠ›+2000" },
            'ring_life':    { name: "ç”Ÿå‘½è­·ç¬¦", cost: 600, desc: "HP+100" },
            'ring_magic':   { name: "é­”åŠ›è€³ç’°", cost: 500, desc: "MP+50" },
            // æ–°å¢æ¡é›†é£¾å“
            'fish_ring':    { name: "é­šé±—æˆ’æŒ‡", cost: 400, desc: "DEF+8" },
            'pearl_necklace':{ name: "çç é …éŠ", cost: 2000, desc: "MP+100" }
        };

        socket.on('connect', () => { socket.emit('joinGame', myToken); });
        socket.on('playerStatsUpdate', (p) => { renderStats(p); renderSlots(p.equipment); renderInventory(p.inventory); });
        socket.on('equipResult', (msg) => { showMsg(msg); });
        
        // ç›£è½éŒ¯èª¤è¨Šæ¯
        socket.on('errorMessage', (msg) => { showMsg("âŒ " + msg); });

        function renderStats(p) {
            document.getElementById('atk').innerText = p.atk;
            document.getElementById('def').innerText = p.def;
            document.getElementById('hp').innerText = p.maxHp;
            document.getElementById('mp').innerText = p.maxMp;
        }

        function renderSlots(eq) {
            const types = ['weapon', 'armor', 'acc'];
            types.forEach(type => {
                const div = document.getElementById(`slot-${type}`);
                const itemId = eq[type];
                if (itemId && ITEM_MAP[itemId]) {
                    div.innerHTML = `<div style="color:#2ecc71; margin-bottom:5px;">${ITEM_MAP[itemId].name}</div><button class="btn btn-unequip" onclick="unequip('${type}')">å¸ä¸‹</button>`;
                } else {
                    div.innerHTML = `<span style="color:#7f8c8d">ç„¡</span>`;
                }
            });
        }

        function renderInventory(inv) {
            const list = document.getElementById('inventory-list');
            list.innerHTML = '';
            let hasEquipable = false;
            Object.keys(inv).forEach(key => {
                const item = ITEM_MAP[key];
                // åªé¡¯ç¤ºå¯è£å‚™çš„ç‰©å“ (æœ‰åœ¨ ITEM_MAP è£¡é¢çš„)
                if (item && inv[key] > 0) {
                    hasEquipable = true;
                    const div = document.createElement('div');
                    div.className = 'inv-item';
                    div.innerHTML = `<div><div class="inv-name">${item.name} x${inv[key]}</div><div class="inv-desc">${item.desc}</div></div><button class="btn" onclick="equip('${key}')">è£å‚™</button>`;
                    list.appendChild(div);
                }
            });
            if (!hasEquipable) list.innerHTML = `<div style="color:#7f8c8d; font-size:12px; padding:20px;">èƒŒåŒ…æ²’æœ‰å¯è£å‚™çš„ç‰©å“<br>(å¦‚è—¥æ°´è«‹è‡³èƒŒåŒ…æŸ¥çœ‹)</div>`;
        }

        function equip(id) { socket.emit('equipItem', id); }
        function unequip(slot) { socket.emit('unequipItem', slot); }
        
        function showMsg(text) {
            const toast = document.getElementById('game-toast');
            toast.innerText = text;
            toast.style.top = "30px"; 
            setTimeout(() => {
                toast.style.top = "-100px"; 
            }, 3000);
        }
    </script>
</body>
</html>
