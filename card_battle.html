<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¡ç‰‡å°æˆ°</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { 
            background-color: #2c3e50; color: #fff; 
            font-family: 'Press Start 2P', monospace; 
            margin: 0; padding: 0; overflow: hidden;
            display: flex; flex-direction: column; height: 100vh;
        }

        /* å€åŸŸåŠƒåˆ† */
        .opponent-area { flex: 1; background: #34495e; display: flex; flex-direction: column; border-bottom: 2px solid #000; }
        .my-area { flex: 1; background: #2c3e50; display: flex; flex-direction: column-reverse; }

        /* æ‰‹ç‰Œå€ */
        .hand-zone { height: 90px; display: flex; justify-content: center; align-items: center; gap: 5px; padding: 5px; background: rgba(0,0,0,0.2); }
        .opponent-hand .card-back { background: #95a5a6; width: 50px; height: 70px; border-radius: 5px; border: 2px solid #fff; }

        /* æˆ°å ´å€ (æ”¾æ€ªç‰©çš„) */
        .field-zone { flex: 1; display: flex; justify-content: center; align-items: center; gap: 10px; position: relative; }
        
        /* ç©å®¶è³‡è¨Š (HP/AP) */
        .player-info { 
            position: absolute; padding: 5px 10px; background: rgba(0,0,0,0.8); 
            border-radius: 10px; border: 1px solid #f1c40f; font-size: 10px;
            z-index: 10;
        }
        .opp-info { top: 10px; left: 10px; }
        .my-info { bottom: 10px; left: 10px; }

        /* å¡ç‰‡æ¨£å¼ (å ´ä¸Š/æ‰‹ç‰Œ) */
        .battle-card {
            width: 60px; height: 80px; background: #34495e; border: 1px solid #fff;
            border-radius: 5px; display: flex; flex-direction: column; align-items: center;
            font-size: 8px; position: relative; cursor: pointer;
        }
        .battle-card img { width: 40px; height: 40px; object-fit: contain; margin-top: 2px; }
        .battle-card .stats { font-size: 7px; margin-top: 2px; color: #f1c40f; }
        .battle-card.unit { border-color: #2ecc71; }
        .battle-card.spell { border-color: #9b59b6; }

        /* ç‹€æ…‹æç¤º */
        #turn-indicator {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 10px 20px; border: 2px solid #e74c3c;
            font-size: 12px; display: none; z-index: 100;
        }
    </style>
</head>
<body>

    <div id="turn-indicator">å›åˆé–‹å§‹</div>

    <div class="opponent-area">
        <div class="hand-zone opponent-hand" id="opp-hand"></div>
        <div class="field-zone" id="opp-field">
            <div class="player-info opp-info">
                <span id="opp-name">å°æ‰‹</span><br>
                HP: <span id="opp-hp" style="color:#e74c3c">50</span>
                AP: <span id="opp-ap" style="color:#3498db">3</span>
            </div>
        </div>
    </div>

    <div class="my-area">
        <div class="hand-zone" id="my-hand"></div>
        <div class="field-zone" id="my-field">
            <div class="player-info my-info">
                <span id="my-name">æˆ‘</span><br>
                HP: <span id="my-hp" style="color:#e74c3c">50</span>
                AP: <span id="my-ap" style="color:#3498db">3</span>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script>
        const socket = io('https://mmo.ttctv-105.cc', { 
    transports: ['websocket', 'polling'],
        
        let myToken = localStorage.getItem('rpg_token');
        if (!myToken) window.location.href = 'index.html';

        // åœ–ç‰‡è·¯å¾‘
        const IMG_BASE_URL = "https://ericleung001.github.io/rpg/img/monsters/";
        
        // éœ€èˆ‡ Server CARD_CONFIG åŒæ­¥ (å»ºè­°ä¹‹å¾Œåšæˆ API è®€å–ï¼Œç¾åœ¨å…ˆè¤‡è£½)
        // é€™è£¡åªéœ€è¦åå­—å’Œåœ–ç‰‡ï¼Œæ•¸å€¼æœƒç”± Server å‚³éä¾†
        const CARD_META = {
            'card_slime': { name: "å²èŠå§†", img: "slime.png" },
            'card_wolf': { name: "ç‹¼ç‹", img: "wolf_king.png" },
            'card_potion': { name: "å›å¾©å¡", icon: "ğŸ’Š" },
            'card_fire': { name: "ç«çƒå¡", icon: "ğŸ”¥" },
            // ... (å…¶ä»–å¡ç‰‡è«‹è‡ªè¡Œè£œä¸Šï¼Œæˆ–ç”¨é€šç”¨é‚è¼¯è™•ç†)
        };

        function getCardImg(cardId) {
            // ç°¡å–®è™•ç†ï¼šå¦‚æœæ˜¯ card_ é–‹é ­ï¼Œå» monster list æ‰¾ï¼Œæˆ–ç›´æ¥ç”¨ ID æ‹†å­—ä¸²
            const key = cardId.replace('card_', '');
            return IMG_BASE_URL + key + ".png";
        }

        socket.on('connect', () => { 
            // é€™è£¡ä¸ç™¼é€ joinGameï¼Œå› ç‚ºæˆ‘å€‘å·²ç¶“åœ¨ server ç«¯è¢«åˆ†é…åˆ°æˆ¿é–“äº†
            // ä½†ç‚ºäº†é©—è­‰èº«ä»½ï¼Œé‚„æ˜¯ç™¼ä¸€ä¸‹æ¯”è¼ƒä¿éšª
            socket.emit('joinGame', myToken); 
        });

        // ğŸŸ¢ æ¥æ”¶æˆ°æ³æ›´æ–°
        socket.on('cardGameUpdate', (data) => {
            renderGame(data);
        });

        function renderGame(data) {
            const me = data.me;
            const opp = data.opponent;

            // 1. æ›´æ–°æ•¸å€¼
            document.getElementById('my-hp').innerText = me.hp;
            document.getElementById('my-ap').innerText = me.ap;
            document.getElementById('opp-name').innerText = opp.name;
            document.getElementById('opp-hp').innerText = opp.hp;
            document.getElementById('opp-ap').innerText = opp.ap;

            // 2. é¡¯ç¤ºå›åˆ
            const indicator = document.getElementById('turn-indicator');
            if (data.turn === socket.id) {
                indicator.innerText = "ğŸ‘‰ ä½ çš„å›åˆ ğŸ‘ˆ";
                indicator.style.display = 'block';
                setTimeout(() => indicator.style.display = 'none', 1500);
            } else {
                indicator.innerText = "â³ å°æ‰‹å›åˆ";
            }

            // 3. æ¸²æŸ“æˆ‘æ–¹æ‰‹ç‰Œ
            const myHandDiv = document.getElementById('my-hand');
            myHandDiv.innerHTML = '';
            me.hand.forEach((cardId, index) => {
                const el = createCardElement(cardId);
                el.onclick = () => useCard(cardId, index); // ä¸‹éšæ®µå¯¦ä½œ
                myHandDiv.appendChild(el);
            });

            // 4. æ¸²æŸ“å°æ‰‹æ‰‹ç‰Œ (åªé¡¯ç¤ºå¡èƒŒ)
            const oppHandDiv = document.getElementById('opp-hand');
            oppHandDiv.innerHTML = '';
            for(let i=0; i<opp.handCount; i++) {
                const back = document.createElement('div');
                back.className = 'card-back';
                oppHandDiv.appendChild(back);
            }

            // 5. æ¸²æŸ“æˆ°å ´ (æš«æ™‚æ˜¯ç©ºçš„ï¼Œä¸‹éšæ®µå¯¦ä½œ)
            // renderField(me.field, 'my-field');
            // renderField(opp.field, 'opp-field');
        }

        function createCardElement(cardId) {
            const div = document.createElement('div');
            div.className = 'battle-card';
            
            // ç°¡å–®åˆ¤æ–·åœ–ç‰‡
            const key = cardId.replace('card_', '');
            const imgUrl = IMG_BASE_URL + key + ".png";
            
            // å¦‚æœæ˜¯é­”æ³•å¡ (potion/fire/shield)ï¼Œç”¨ Emoji
            let visual = `<img src="${imgUrl}" onerror="this.style.display='none'">`;
            if (['potion','fire','shield'].some(x => cardId.includes(x))) {
                visual = `<div style="font-size:20px; margin-top:10px;">âœ¨</div>`;
            }

            div.innerHTML = `
                ${visual}
                <div style="font-size:6px; overflow:hidden; height:10px;">${key}</div>
                <div class="stats"></div>
            `;
            return div;
        }

        function useCard(cardId, index) {
            console.log("å˜—è©¦ä½¿ç”¨å¡ç‰‡:", cardId);
            // é€™è£¡ä¹‹å¾Œæœƒç™¼é€ socket.emit('cardAction', { type: 'play', index: index });
        }

    </script>
</body>
</html>
